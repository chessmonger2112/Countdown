<!DOCTYPE html>
<html>
  <head>
    <style>
    #container{
      width:100%;
      text-align: center;
      position: absolute;
      top: 250px;
    }
    .appear{
      display: none;
    }
    input[type=number]{
    width: 40px;
    }

    </style>
  </head>
  <body>
    <span id="container">
      <h1 id="error"></h1>
      <div><input type="number" size="4" placeholder="MM" class="disappear" id="minute"><input type="number" class="disappear" size="4" placeholder="SS" max="2" id="second"></div>
      <div><button class="disappear" id="enter">Enter</button></div>
      <span>Countdown timer</span>
      <div id="countdown">
      <button class="appear" id="start">Start</button><button class="appear" id="pause">Pause</button><button class="appear" id="reset">Reset</button><div id ="display"></div>
    </span>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js" type="text/javascript"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js" type="text/javascript"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone-localstorage.js/1.0/backbone.localStorage-min.js" type="text/javascript"></script>
    <script>
      var app = {};
      var initTotalSeconds;
      var totalSeconds;
      var initMinute;
      var initSecond;
      var go = false;

      var Time = Backbone.Model.extend({
        defaults: {
          minute: 0,
          second: 0
        },
          initialize: function(){
          console.log("Welcome to this world time");
        }
      });

      var time = new Time;

      var Clock = Backbone.Collection.extend({
        model: Time
      });

      var clock = new Clock;

        // renders the full list of todo items calling TodoView for each one.
      app.AppView = Backbone.View.extend({
        el: '#container',
        template: _.template("<h3>Hello</h3>"),
        initialize: function () {
          this.timer();
        },
        events: {
          'click #start': 'start', 'click #pause': 'pause','click #reset' : 'reset',"click #enter" :"enter"
        },
        pause:function(){
          go = false;
        },
        timer:function(){
          console.log("Timers for everyone");
          setInterval(function(){
            if (go && totalSeconds >= 0)
            {
              var minute = time.get("minute");
              var second = time.get("second")

              $("#display").text("Minute is " + minute + " Second is " + second);

              totalSeconds --;
              if (second === 0)
              {
                minute --;
                second = 60;
              }
              second --;

              time.set("minute",minute);
              time.set("second",second);
            }
          },1000);
        },
        enter:function(){
          console.log("Enter executed");
          var minute = this.$('#minute').val();
          var second = this.$("#second").val();
          minute = Number(minute);
          second = Number(second);

          if (minute < 99 && second < 99 && minute >= 0 && second >= 0)
          {
            initMinute = minute;
            initSecond = second;
            initTotalSeconds = minute * 60 + second;
            totalSeconds = initTotalSeconds;
            time = new Time({minute:initMinute,second:initSecond});
            clock.add(time);
            $(".appear").show();
            $(".disappear").css("visibility","hidden");
            this.$("#error").text("");
          }
          else
          {
            this.$("#error").text("Not a valid input. Must be in MM:SS");
          }
        },
        reset:function(){
          totalSeconds = initTotalSeconds;
          // clock.models[0].set("minute",initMinute);
          // clock.models[0].set("second",initSecond);

          time.set("minute",initMinute);
          time.set("second",initSecond);
          $("#display").text("Minute is " + initMinute + " Second is " + initSecond);


          go = false;
        },
        start:function(){
          go = true;
        }
      });

      app.appView = new app.AppView();
      console.log("testting bro");

    </script>
  </body>
</html>
