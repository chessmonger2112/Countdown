<!DOCTYPE html>
<html>
  <head>
    <style>
    #container{
      width:100%;
      text-align: center;
      position: absolute;
      top: 250px;
    }
    .appear{
      display: none;
    }
    input[type=number]{
    width: 47px;
    }
    #input-container{
      text-align: center;
    }

    </style>
  </head>
  <body>
    <div id="container">
      <h1 id="error"></h1>
      <div id="input-container"><input type="number" placeholder="MMSS" class="disappear" id="alarm"></div>
      <div><button class="disappear" id="enter">Enter</button></div>
      <span>Countdown timer</span>
      <div id="countdown">
      <button class="appear" id="start">Start</button><button class="appear" id="pause">Pause</button><button class="appear" id="reset">Reset</button><div id ="display"></div>
    </div>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js" type="text/javascript"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js" type="text/javascript"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone-localstorage.js/1.0/backbone.localStorage-min.js" type="text/javascript"></script>
    <script>
      var app = {};
      var initTotalSeconds;
      var totalSeconds;
      var initMinute;
      var initSecond;
      var go = false;

      var Time = Backbone.Model.extend({
        defaults: {
          minute: 0,
          second: 0
        },
          initialize: function(){
        }
      });

      var time = new Time;

      app.AppView = Backbone.View.extend({
        el: '#container',
        initialize: function () {
          this.timer();
        },
        events: {
          'click #start': 'start', 'click #pause': 'pause','click #reset' : 'reset',"click #enter" :"enter"
        },
        pause:function(){
          go = false;
        },
        timer:function(){
          setInterval(function(){
            if (go && totalSeconds >= 0)
            {
              var minute = time.get("minute");
              var second = time.get("second")
              $("#display").text("Minute is " + minute + " Second is " + second);
              totalSeconds --;
              if (second === 0)
              {
                minute --;
                second = 60;
              }
              second --;

              time.set("minute",minute);
              time.set("second",second);
            }
          },1000);
        },
        enter:function(){
          var input = this.$("#alarm").val();
          var inputL = input.length;
          var minute = "";
          var second = "";
          if(inputL > 4 || input ==="")
          {
            this.$("#error").text("Not a valid input. Must be in MM:SS");
          }
          else
          {
            var validNumber = true;;
            for(var i = 0; i < inputL; i ++)
            {
              var currentNum = Number(input[i]);
              if (currentNum % 1 !==0)
              {
                validNumber = false;
              }
            }
            if (!validNumber)
            {
              this.$("#error").text("Please enter an integer value");
            }
            else
            {
              this.$("#error").text("");
              function reverseStr(string)
              {
                var array = string.split("");
                array.reverse();
                string = array.join("");
                return string;
              }

              input = reverseStr(input);

              for(var i = 0; i < inputL; i ++)
              {
                var currentNum = input[i];
                if (i <= 1)
                {
                  second += currentNum;
                }
                else
                {
                  minute += currentNum
                }
              }
              minute = reverseStr(minute);
              second = reverseStr(second);
            }
            minute = Number(minute);
            second = Number(second);
            initMinute = minute;
            initSecond = second;
            initTotalSeconds = minute * 60 + second;
            totalSeconds = initTotalSeconds;
            time = new Time({minute:initMinute,second:initSecond});
            $(".appear").show();
            $(".disappear").css("visibility","hidden");
          }
        },
        reset:function(){
          totalSeconds = initTotalSeconds;
          time.set("minute",initMinute);
          time.set("second",initSecond);
          $("#display").text("Minute is " + initMinute + " Second is " + initSecond);


          go = false;
        },
        start:function(){
          go = true;
        }
      });

      app.appView = new app.AppView();

    </script>
  </body>
</html>
